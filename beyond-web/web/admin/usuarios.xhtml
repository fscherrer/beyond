<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="../templates/template.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core">

  <ui:define name="titulo">
    <h:outputText value="#{msgs.Usuario_tituloPagina}" />
  </ui:define>

  <ui:define name="conteudo">

    <p:dialog header="#{msgs.Usuario_tituloEditor}" widgetVar="editor"
              resizable="false" modal="true">  
      <h:form id="formEdicao">
        <h:panelGrid id="panelEdicao" columns="1">
          <h:panelGrid id="panelEdicaoCampos" columns="2" cellspacing="4">
            <h:outputLabel value="#{msgs.Usuario_login}" />
            <p:inputText id="login" value="#{usuariosMB.usuario.login}" 
                         required="true" requiredMessage="#{msgs.Usuario_login_naoInformado}" />

            <h:outputLabel value="#{msgs.Usuario_senha}" 
                           rendered="#{usuariosMB.operacao eq 'INCLUSAO'}" />
            <p:password id="senha" value="#{usuariosMB.usuario.senha}" 
                        required="true" requiredMessage="#{msgs.Usuario_senha_naoInformada}"
                        rendered="#{usuariosMB.operacao eq 'INCLUSAO'}" />

            <h:outputLabel value="#{msgs.Usuario_nome}" />
            <p:inputText id="nome" value="#{usuariosMB.usuario.nome}" 
                         required="true" requiredMessage="#{msgs.Usuario_nome_naoInformado}" />
          </h:panelGrid>

          <!-- TODO: combo para selecionar a casa -->
          <p:messages id="edicaoMessages" showDetail="true" />

          <f:facet name="footer">
            <!-- obs.: nÃ£o posso usar && no javascript aqui -->
            <h:panelGrid id="panelEdicaoButtons" columns="2" cellspacing="4">
              <p:commandButton id="buttonOk" value="#{msgs.global_ok}"
                               actionListener="#{usuariosMB.salvar()}" 
                               update="panelEdicao :formListagem:tableUsuarios"
                               oncomplete="if(!(args.validationFailed || args.exception)) editor.hide()"/>
              <p:commandButton id="buttonCancelar" value="#{msgs.global_cancelar}"
                               onclick="editor.hide();"/>
            </h:panelGrid>
          </f:facet>
        </h:panelGrid>
      </h:form>
    </p:dialog>


    <h:form id="formListagem">
      <p:dataTable id="tableUsuarios" var="usuario" value="#{usuariosMB.usuarios}">
        <p:column sortBy="#{usuario.login}" headerText="#{msgs.Usuario_login}">
          <h:outputText value="#{usuario.login}" />
        </p:column>

        <p:column sortBy="#{usuario.nome}" headerText="#{msgs.Usuario_nome}">
          <h:outputText value="#{usuario.nome}" />
        </p:column>

        <p:column sortBy="#{usuario.casa}" headerText="#{msgs.Usuario_casa}">
          <h:outputText value="#{usuario.casa}" />
        </p:column>

        <p:column headerText="" width="100">
          <p:commandButton value="#{msgs.global_editar}" 
                           actionListener="#{usuariosMB.editar('EDICAO')}"
                           oncomplete="editor.show()" update=":formEdicao:panelEdicao">
            <f:setPropertyActionListener value="#{usuario}" target="#{usuariosMB.usuario}" />
          </p:commandButton>
          <p:commandButton value="#{msgs.global_excluir}" action="none">
            <f:setPropertyActionListener value="#{usuario}" target="#{usuariosMB.usuario}" />
          </p:commandButton>
        </p:column>

      </p:dataTable>

      <p:commandButton value="#{msgs.global_incluir}" onclick="editor.show();" 
                       update=":formEdicao:panelEdicao"
                       actionListener="#{usuariosMB.editar('INCLUSAO')}" />

    </h:form>
  </ui:define>

</ui:composition>
