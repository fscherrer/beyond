<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./templates/template.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core">


  <ui:define name="titulo">
    <h:outputText value="#{msgs.Evento_tituloPagina}" />
  </ui:define>

  <ui:define name="conteudo">

    <!-- Detalhes evento -->
    <h:form id="formDetalhesEvento">
      <p:dialog widgetVar="dialogDetalhesEvento"
                id="dialogDetalhesEvento"
                header="#{msgs.global_detalhes}"
                resizable="false"
                width="540">
        <h:panelGrid columns="2" width="100%" cellpadding="4" cellspacing="0"
                     columnClasses=",panelDetalhesEventoColumn2"
                     rowClasses=",panelDetalhesEventoRowPar">
          <h:outputText value="#{msgs.Index_dialogDetalhesEvento_Evento}" class="negrito"/>
          <h:outputText value="#{eventosMB.entidade.nome}" class="detalhesEventoTitulo" />

          <h:outputText value="#{msgs.Index_dialogDetalhesEvento_Bandas}" styleClass="negrito"/>
          <h:panelGroup layout="block" styleClass="panelCru" style="margin: 0px auto;">
            <ui:repeat value="#{eventosMB.entidade.bandas}" var="banda" varStatus="repeatStatus"><!-- 
                   value: ternário: se for a última banda, imprime ' e ', senão ', '
                   rendered: só imprime se tiver mais de uma banda -->
              <h:outputText value="#{repeatStatus.last ? ' e ' : ', '}" 
                            rendered="#{repeatStatus.index gt 0}" />
              <h:outputText value="#{banda.nome}" styleClass="detalhesEventoBanda" />
            </ui:repeat>
          </h:panelGroup>

          <h:outputText value="#{msgs.Index_dialogDetalhesEvento_Local}" styleClass="negrito"/>
          <p:panelGrid columns="1" styleClass="panelGridSemBordas panelGridDetalhesEventoEndereco">
            <h:outputText value="#{eventosMB.entidade.casa.nome}" styleClass="detalhesEventoCasa"/>
            <h:outputText value="#{eventosMB.entidade.casa.endereco.logradouro}, 
                          #{msgs.Endereco_numero} #{eventosMB.entidade.casa.endereco.numero}" />
            <h:outputText value="#{msgs.Endereco_bairro} #{eventosMB.entidade.casa.endereco.bairro}" />
            <h:outputText value="#{eventosMB.entidade.casa.endereco.cidade.nome} - #{eventosMB.entidade.casa.endereco.cidade.uf.sigla}" />
            <h:outputText value="#{eventosMB.entidade.casa.endereco.cep}" />
          </p:panelGrid>

          <h:outputText value="#{msgs.Index_dialogDetalhesEvento_DataHora}" styleClass="negrito"/>
          <h:outputText value="#{eventosMB.entidade.datahora}">
            <f:convertDateTime pattern="dd/MM/yyyy   -   HH:mm"/>
          </h:outputText>

          <h:outputText value="#{msgs.Index_dialogDetalhesEvento_Valor}" styleClass="negrito"/>
          <h:outputText value="#{eventosMB.entidade.valor}">
            <f:convertNumber minFractionDigits="2" type="currency" />
          </h:outputText>
        </h:panelGrid>

        <p:panel styleClass="panelCru" style="text-align: center;">
          <p:commandButton value="#{msgs.global_ok}" onclick="dialogDetalhesEvento.hide();"/>
        </p:panel>
      </p:dialog>
    </h:form>


    <!-- listagem de eventos -->
    <h:form>
      <!-- link área administrativa -->
      <h:panelGroup layout="block" style="text-align: right; padding: 4px 0px 4px 0px;">
        <h:link value="#{msgs.global_area_administrativa}" outcome="login"/>
      </h:panelGroup>

      <!-- mensagens no topo -->
      <h:panelGroup layout="block" style="vertical-align: middle;">
        <p:messages id="mensagens" showDetail="true" />
      </h:panelGroup>


      <h:panelGroup layout="block">
        <!-- esquerda -->
        <h:panelGroup layout="block" 
                      style="float: left; width: 192px; margin-right: 8px;">
          <p:dataTable id="tableBandas" var="banda" value="#{bandasMB.entidades}"
                       selection="#{eventosMB.bandasSelecionadas}" selectionMode="mutiple"
                       rowKey="#{banda.id}" scrollable="true" scrollHeight="150">
            <p:column headerText="#{msgs.Evento_banda}">
              <h:outputText value="#{banda.nome}" />
            </p:column>
          </p:dataTable>

          <p:commandButton value="#{msgs.global_atualizar}" 
                           action="#{eventosMB.carregarEntidades()}"
                           update="tableEventos mensagens"/>
        </h:panelGroup>

        <!-- direita -->
        <h:panelGroup layout="block" style="margin-left: 200px;">
          <p:dataTable id="tableEventos" var="evento" value="#{eventosMB.entidades}">
            <p:column sortBy="#{evento.nome}" headerText="#{msgs.Evento_nome}">
              <h:outputText value="#{evento.nome}" />
            </p:column>
            <p:column sortBy="#{evento.datahora}" headerText="#{msgs.Evento_dataHora}">
              <h:outputText value="#{evento.datahora}">
                <f:convertDateTime pattern="dd/MM/yyyy  -  HH:mm"/>
              </h:outputText>
            </p:column>

            <p:column sortBy="#{evento.casa.nome}" headerText="#{msgs.Evento_casa}">
              <h:outputText value="#{evento.casa.nome}" />
            </p:column>

            <p:column sortBy="#{evento.casa.endereco.cidade.nome}" headerText="#{msgs.Evento_cidade}">
              <h:outputText value="#{evento.casa.endereco.cidade.nome}"/>
            </p:column>

            <p:column width="30" headerText="#{msgs.global_detalhes}">
              <p:commandButton value="Detalhes" title="Detalhes" oncomplete="dialogDetalhesEvento.show();"
                               update=":formDetalhesEvento:dialogDetalhesEvento">
                <f:setPropertyActionListener value="#{evento}" target="#{eventosMB.entidade}" />
              </p:commandButton>
            </p:column>

          </p:dataTable>
        </h:panelGroup>

        <!-- clear -->
        <h:panelGroup layout="block" style="clear: both;" />

      </h:panelGroup>

    </h:form>
  </ui:define>

</ui:composition>
